<ion-header>
  <ion-navbar>
    <ion-title>Checkout</ion-title>
  </ion-navbar>
</ion-header>

<ion-content class='cards-bg'>
  <ion-card>
    <ion-card-header>
      How was {{ticketService.firestoreTicket?.location}}?
    </ion-card-header>
    <ion-card-content>
      <p id="rate-and-review">Rate and review the items you ordered.</p>
      <ng-container *ngFor='let item of myTabItems; let i=index;'>
        <ion-item class='total tab-item' *ngIf="i<displayLimit || displayAllItems">
          <h2>{{item.name}}
            <span class='line-details' *ngIf='item.users.length > 1'> (shared)</span>
          </h2>
          <div class="reviews">
            <rating [(ngModel)]="item.rating">
            </rating>
            <ion-item *ngIf="item.rating! > 0" class="item-feedback">
              <ion-textarea [(ngModel)]="item.feedback" placeholder="Leave feedback" autocomplete="on" spellcheck="on"
                autocorrect="on"></ion-textarea>
            </ion-item>
          </div>
          <div item-end>
            <h2>${{item.userShare! / 100 | number:'1.2-2'}}</h2>
          </div>
        </ion-item>
      </ng-container>
      <button *ngIf="!displayAllItems && myTabItems.length > displayLimit" ion-button block clear icon-end
        color="tabify" (click)="displayAllItems = true">
        Show All
        <ion-icon name="md-arrow-dropright"></ion-icon>
      </button>
    </ion-card-content>
  </ion-card>
  <ion-card>
    <ion-card-header>
      My Total
    </ion-card-header>
    <ion-card-content>
      <ion-item class='total'>
        <h2>Subtotal</h2>
        <div item-end>
          <h2>${{ticketService.userSubtotal / 100 | number: '1.2-2'}}</h2>
        </div>
      </ion-item>
      <ion-item class='total' (click)="adjustTip()">
        <h2>Tip
          <span class='line-details'>({{ticketService.userTipPercentage}}%)</span>
          <ion-icon class="adjust-tip" name='md-create'></ion-icon>
        </h2>
        <div item-end>
          <h2>${{ticketService.userTip / 100 | number: '1.2-2'}}</h2>
        </div>
      </ion-item>
      <ion-item class='total'>
        <h2>Tax
          <span class='line-details'>({{ticketService.userTaxRate * 100 | number: '1.2-2'}}%)</span>
        </h2>
        <div item-end>
          <h2>${{ticketService.userTax / 100 | number: '1.2-2'}}</h2>
        </div>
      </ion-item>
      <ion-item id='grand-total'>
        <h2>My Grand Total</h2>
        <div item-end>
          <h2>${{ticketService.userGrandTotal / 100 | number: '1.2-2'}}</h2>
        </div>
      </ion-item>
      <ion-item>
        <ion-icon class="linked-card-icon" name="card" item-start></ion-icon>
        <ion-label>
        </ion-label>
        <ion-select [(ngModel)]="selectedPaymentMethod" interface="alert" submitText="Ok" cancelText="Cancel"
          [selectOptions]="selectOptions">
          <ion-option *ngFor="let method of this.paymentService.paymentMethods" [value]="method">
            {{method.card_type}}: ****{{method.last_four_digits}}
          </ion-option>
          <ion-option value="">Add New Card</ion-option>
        </ion-select>
      </ion-item>
      <button id="submit-payment-btn" ion-button block (click)="pay()">Submit Payment of ${{ticketService.userGrandTotal / 100 | number: '1.2-2'}}</button>
    </ion-card-content>
  </ion-card>
</ion-content>
