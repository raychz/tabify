<ion-header>
  <ion-navbar hideBackButton>
    <ion-buttons left>
      <button (click)="cancel()" ion-button icon-start>
        <ion-icon name="arrow-back"></ion-icon>
        Back
      </button>
    </ion-buttons>
    <ion-title>Coupons</ion-title>
  </ion-navbar>
</ion-header>

<ion-content class="cards-bg">
  <ion-card>
    <ion-card-content>
      <ion-row class="header">
        Exclusive Coupons, Deals, and Promos
      </ion-row>
      <ion-row class="header">
        Only on Tabify!
      </ion-row>
      <!-- <ion-row>
        <ion-segment [disabled]="!fullCouponsPage" (ionChange)="selectSegment($event)" [(ngModel)]="selectedSegment">
          <ion-segment-button [value]="couponGroup.validCoupons">
            <div>Current</div>
          </ion-segment-button>
          <ion-segment-button [value]="couponGroup.upcomingCoupons">
            <div>Upcoming</div>
          </ion-segment-button>
          <ion-segment-button [value]="couponGroup.usedCoupons">
            <div>Used</div>
          </ion-segment-button>
        </ion-segment>
      </ion-row> -->
    </ion-card-content>
  </ion-card>

  <ion-list *ngIf="selectedSegment === couponGroup.validCoupons">
    <ion-item *ngFor="let coupon of couponService.validCoupons">
      <ion-card class="coupon-card" (click)="expandCoupon(coupon)">
        <ion-card-content>
          <ion-row>
            <ion-col col-8>
              <ion-row>
                  <ion-col col-3>
                      <ion-avatar class="avatar">
                        <img [src]="coupon.location.photo_url" class="location-image">
                      </ion-avatar>
                    </ion-col>
                    <ion-col col-9>
                      <ion-row>
                        {{ coupon.location.name }}
                      </ion-row>
                      <ion-row>
                        <span text-nowrap>{{ coupon.location.street1 }}, </span>
                        <span text-nowrap>{{ coupon.location.city }}, {{ coupon.location.state }}</span>
                      </ion-row>
                    </ion-col>
              </ion-row>
              <ion-row *ngIf="coupon.id === expandedCouponId">
                  <p text-wrap class="coupon_description">
                    {{ coupon.description }}, {{ coupon.estimated_dollar_value }}
                  </p>
              </ion-row>

            </ion-col>
            <ion-col col-4>
                <img class="coupon-image" *ngIf="coupon.id === expandedCouponId; else coupon_value" [src]='coupon.image_url'>
                <ng-template #coupon_value class="coupon-value">
                    {{ coupon.coupon_type === CouponType.dollar_value ? '$' + (coupon.value / 100 | number: '1.2-2') : coupon.value + '%' }}
                    off {{ coupon.coupon_off_of === CouponOffOf.ticket ? 'whole ticket' : 'one item'}}
                </ng-template>
              </ion-col>

          </ion-row>

          <ion-row *ngIf="coupon.id === expandedCouponId">
            <ion-col class="end_info">
              Usage: {{ coupon.usage_count }}/{{ coupon.usage_limit }}
            </ion-col>
            <ion-col>
              <button (click)="redeemCoupon(coupon)" class="end_info">
                  {{ fullCouponsPage ? 'Redeem' : 'Select' }}
              </button>
            </ion-col>
            <ion-col class="end_info">
              Valid until: {{ coupon.coupon_end_date.getMonth() }}-{{ coupon.coupon_end_date.getDay() }}
            </ion-col>
          </ion-row>
        </ion-card-content>
      </ion-card>
    </ion-item>
  </ion-list>
  <ion-label *ngIf="selectedSegment !== couponGroup.validCoupons">
    Segment under construction and coming soon!
  </ion-label>
</ion-content>
