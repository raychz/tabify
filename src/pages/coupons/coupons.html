<ion-header>
  <ion-navbar hideBackButton>
    <ion-title class="page-title">Coupons</ion-title>
    <ion-buttons left>
      <button (click)="cancel()" ion-button icon-start>
        <ion-icon name="arrow-back"></ion-icon>
        <ion-label *ngIf="platform.is('ios')">
          Back
        </ion-label>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content class="cards-bg">
  <ion-card>
    <ion-card-content>
      <ion-row>
        <ion-col class="header">
          <span  class="first-header">
            Exclusive Coupons, Deals, and Promos
          </span>
          <br>
          <span class="second-header">
            Only on Tabify!
          </span>
        </ion-col>
      </ion-row>
      <!-- <ion-row>
        <ion-segment [disabled]="!fullCouponsPage" (ionChange)="selectSegment($event)" [(ngModel)]="selectedSegment">
          <ion-segment-button [value]="couponGroup.validCoupons">
            <div>Current</div>
          </ion-segment-button>
          <ion-segment-button [value]="couponGroup.upcomingCoupons">
            <div>Upcoming</div>
          </ion-segment-button>
          <ion-segment-button [value]="couponGroup.usedCoupons">
            <div>Used</div>
          </ion-segment-button>
        </ion-segment>
      </ion-row> -->
    </ion-card-content>
  </ion-card>

  <ion-list *ngIf="selectedSegment === couponGroup.validCoupons">
    <ion-item *ngFor="let coupon of couponService.validCoupons">
      <ion-card class="coupon-card" (click)="expandCoupon(coupon)">
        <ion-card-content class="card-content">
          <ion-row>
            <ion-col col-9>
                  <ion-item class="location-item">
                    <ion-avatar item-start class="avatar">
                      <img [src]="coupon.location.photo_url" class="location-image"/>
                    </ion-avatar>
                    <h2 text-wrap>{{ coupon.location.name }}</h2>
                    <h3 text-wrap class="restaurant-address">
                      <span text-nowrap>{{ coupon.location.street1 }},</span>
                      <span text-nowrap>{{ coupon.location.city }}, {{coupon.location.state }}</span>
                    </h3>
                  </ion-item>
                  <ion-row *ngIf="coupon.id === expandedCouponId">
                    <ion-col>
                      <p text-wrap class="coupon_description">
                        {{ coupon.description }}
                      </p>
                    </ion-col>
                  </ion-row>
            </ion-col>
            <ion-col class="value" col-3>
                <img class="coupon-image" *ngIf="coupon.id === expandedCouponId; else coupon_value" [src]='coupon.image_url'>
                <ng-template #coupon_value>
                    {{ coupon.coupon_type === CouponType.dollar_value ? '$' + (coupon.value / 100 | number: '1.2-2') : coupon.value + '%' }}
                    off {{ coupon.coupon_off_of === CouponOffOf.ticket ? 'whole ticket' : 'one item'}}
                </ng-template>
            </ion-col>

          </ion-row>

          <ion-row *ngIf="coupon.id === expandedCouponId">
            <ion-col class="end-info">
              Usage: {{ coupon.usage_count }}/{{ coupon.usage_limit ? coupon.usage_limit : 'âˆž' }}
            </ion-col>
            <ion-col class="end-info">
              <button (click)="redeemCoupon(coupon)">
                  {{ fullCouponsPage ? 'Redeem' : 'Select' }}
              </button>
            </ion-col>
            <ion-col class="end-info">
              Valid until: {{ coupon.coupon_end_date.getMonth() + 1}}-{{ coupon.coupon_end_date.getDate() }}
            </ion-col>
          </ion-row>
        </ion-card-content>
      </ion-card>
    </ion-item>
  </ion-list>
  <ion-label *ngIf="selectedSegment !== couponGroup.validCoupons">
    Segment under construction and coming soon!
  </ion-label>
</ion-content>
