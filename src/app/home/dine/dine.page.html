<app-tabify-header>

</app-tabify-header>

<ion-content>
  <ion-card class="location-card" #location (click)="showLocations()">
    <ion-item lines="none">
      <ion-avatar item-start>
        <ion-img [src]='locationService.selectedLocation?.photo_url'></ion-img>
      </ion-avatar>
      <ion-label class="location-info">
        <h2 text-wrap>{{ locationService.selectedLocation?.name }}</h2>
        <h3 text-wrap>
          <span text-nowrap>{{ locationService.selectedLocation?.street1 }}, </span>
          <span text-nowrap>{{ locationService.selectedLocation?.city }}, {{ locationService.selectedLocation?.state }}</span>
        </h3>
      </ion-label>
      <ion-icon name="caret-up-outline"></ion-icon>    
    </ion-item>
  </ion-card>

  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md>
        <ion-card>
          <ion-img [src]="locationService.selectedLocation?.photo_url" alt="Could not load location image"></ion-img>
          <ion-button class="submit-button" expand="block" color="warning" (click)="viewMenu()">
            <ion-icon name="book-outline"></ion-icon>
            See Menu
          </ion-button>
        </ion-card>
      </ion-col>
      <ion-col size="12" size-md>
        <ion-card>
          <ion-card-header class="header">
              Join Your Ticket
                <app-fraud-code class="fraud-code"></app-fraud-code>
          </ion-card-header>
          
        
          <!-- <ion-card-content class="content"> -->
                  <form [formGroup]="tabForm">
                    <ion-item>
                      <ion-input class="small-input" type="tel" inputmode="tel" placeholder="Enter ticket number..." formControlName="ticketNumber" (ionChange)="validateTicketNumber(tabForm.value)"></ion-input>
                      <ion-icon name="help-circle-outline" class="help-icon" (click)="helpToast('Your ticket number can usually be found at the top or bottom of your check. Please diregard any letters in your number.', 5000)"></ion-icon>
                    </ion-item>
                      <p class="loader-bad" *ngIf="errorMessage"> {{this.errorMessage}} </p>
                      <ion-button class="submit-button" expand="block" color="warning" (click)="enterTicketNumber(tabForm.value)" *ngIf="!checkingTicketNumber && !existingTicket && !newTicket" [disabled]="tabForm.invalid || errorMessage !== ''">
                        <ion-icon name="restaurant-outline"></ion-icon>
                        Find Ticket
                      </ion-button>
                  </form>
              <ng-container *ngIf="existingTicket">
                  <p class="loader-good">Your ticket has already been opened. Joining ticket now...</p>
                  <!-- <ion-button class="submit-button" expand="block" color="warning" (click)="nextPage()">
                    <ion-icon name="restaurant-outline"></ion-icon>
                    Join Ticket
                  </ion-button> -->
              </ng-container>
              <ng-container *ngIf="newTicket">
                  <form [formGroup]="newTicketForm">
                    <p class="loader-warning">Your ticket hasn't been opened yet, please enter the following:</p>
                    <ion-item>
                      <p class="explain-text">How do you want to split the bill?</p>
                      <ion-icon name="help-circle-outline" class="help-icon" (click)="helpToast('Please select a method for splitting the bill. If you are paying alone, select No Split.', 5000)"></ion-icon>
                    </ion-item>
                    <ion-radio-group formControlName="mode">
                    <!-- Default Selected Value not working when binding radio to form  -->
                    <!-- <ion-radio-group formControlName="mode" [value]="ticketMode.ITEMIZE"> -->
                      <ion-grid>
                        <ion-row>
                          <ion-col size="4">
                            <ion-item class="ticket-mode">
                              <ion-label>
                                Itemize
                              </ion-label>
                              <ion-radio [value]="ticketMode.ITEMIZE"></ion-radio>
                            </ion-item>
                          </ion-col>
                          <ion-col size="4">
                            <ion-item class="ticket-mode">
                              <ion-label>
                                Even Split
                              </ion-label>
                              <ion-radio [value]="ticketMode.EVEN_SPLIT"></ion-radio>
                            </ion-item>
                          </ion-col>
                          <ion-col size="4">
                            <ion-item class="ticket-mode">
                              <ion-label>
                                No Split
                              </ion-label>
                              <ion-radio value="ticketMode.NO_SLIT"></ion-radio>
                            </ion-item>
                          </ion-col>
                        </ion-row>
                      </ion-grid>  
                    </ion-radio-group>
                    <!-- <ion-item class="input">
                      <ion-select value="itemize" interface="popover" class="input">
                        <ion-select-option value="itemize">Itemize and Split</ion-select-option>
                        <ion-select-option value="even">Evenly Split the Total</ion-select-option>
                        <ion-select-option value="full">Pay in Full/Don't Split</ion-select-option>
                      </ion-select>
                    </ion-item> -->     
                    <ion-item>
                      <p class="explain-text">How many are in your party?</p>
                      <ion-icon name="help-circle-outline" class="help-icon" (click)="helpToast('Please enter the number of people in your party who are also paying with Tabify.', 5000)"></ion-icon>
                    </ion-item>
                    <ion-item class="input">
                      <ion-input type="tel" formControlName="partySize" placeholder="Enter party size..."></ion-input>
                    </ion-item>
                  </form>
                  <ion-button class="submit-button" expand="block" color="warning" (click)="updateTicketConfig(newTicketForm.value)">
                    <ion-icon name="restaurant-outline"></ion-icon>
                    Open Ticket
                  </ion-button>
              </ng-container>
                <ion-row *ngIf="checkingTicketNumber">
                  <ion-col class="center-element" >
                    <ion-spinner></ion-spinner>
                  </ion-col>
                </ion-row>
          <!-- </ion-card-content> -->
        </ion-card>
        <app-coupon></app-coupon>
      </ion-col>
    </ion-row>
  </ion-grid>



  <!-- <ion-select value="test1" interface="popover">
    <ion-select-option value="test1">
      fgh
    </ion-select-option>
    <ion-select-option value="test2">
      fgijhg
    </ion-select-option>
  </ion-select> -->
  <!-- <ion-icon name="chevron-forward-outline" class="slide-arrow forward-arrow"></ion-icon>
  <ion-icon name="chevron-back-outline" class="slide-arrow back-arrow"></ion-icon> -->
</ion-content>
